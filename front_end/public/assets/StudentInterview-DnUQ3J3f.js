import{f as F,l as K,r as d,ai as W,aB as $,o as N,c as U,a as t,w as n,b as f,ac as S,ad as j,d as D,ar as R,a2 as h,F as L,u as X,P as Y,n as T,aC as Z,aD as ee,_ as x,a0 as te,$ as oe}from"./index-WXGUVd8R.js";import{R as P}from"./index-lwTdiljL.js";import{N as ne}from"./index-CahTtWIC.js";import{a as se}from"./index-DAOWbYVA.js";import"./index-CMBfAjpb.js";import{F as ae}from"./index-CVxqqtcy.js";import{R as le}from"./index-Bo4SLy1v.js";import{C as re}from"./index-BV5GXoeu.js";import{B as ie}from"./index-DLf2m0OP.js";import"./use-placeholder-ClGZrsmh.js";import"./request-BsTyHzWx.js";import"./use-route-BdHUjtqw.js";const ce={class:"rate"},ue=!1,fe=F({__name:"StudentVideoChat",props:["setID"],setup(p){const w=K(),c=d(),i=d(),r=d(!1),m=d(!1),v=d(!1);let k=!0,l;const q={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun.l.google.com","stun:stun1.l.google.com"]}]},a=new RTCPeerConnection(q),E={audio:!0,video:!0};let I=!1,_;const b=d(!1),H=X(),B=function(){b.value=!1,c.value.srcObject&&V(),H.push("/studentHome")},M=function(){if(k||l.disconnect(),!p.setID){T("setID出错了，请重新点击");return}l=Z("https://localhost:3000",{query:{username:w.data.username,role:"student",setID:p.setID}}),l.on("isEnd",()=>{ee({duration:0,forbidClick:!0,message:"等待评价中"})}),l.on("theRate",s=>{$(),_=s,b.value=!0}),l.on("ready",()=>{r.value=!0,m.value=!1}),k=!1},Q=function(){a.ontrack=({streams:o})=>{i.value.srcObject=o[0],i.value.play()},a.onnegotiationneeded=async()=>{try{I=!0,await a.setLocalDescription(),l.emit("message",{description:a.localDescription})}catch(o){console.error(o)}finally{I=!1}},a.onicecandidate=({candidate:o})=>l.emit("message",{candidate:o}),a.oniceconnectionstatechange=()=>{a.iceConnectionState==="failed"&&a.restartIce()};let s=!1;const e=async({description:o,candidate:g})=>{try{if(o){const u=o.type==="offer"&&(I||a.signalingState!=="stable");if(s=!ue&&u,s)return;await a.setRemoteDescription(o),o.type==="offer"&&(await a.setLocalDescription(),l.emit("message",{description:a.localDescription}))}else if(g)try{await a.addIceCandidate(g)}catch(u){if(!s)throw u}}catch(u){console.error(u)}};l.on("message",e)},z=function(){m.value=!0,M(),Q()};async function O(){try{const s=await navigator.mediaDevices.getUserMedia(E);for(const e of s.getTracks())a.addTrack(e,s);c.value.srcObject=s,c.value.play(),v.value=!0}catch(s){console.error(s)}}const C=d("暂停"),V=function(){if(C.value=="暂停"){const s=c.value.srcObject;if(s)for(const e of s.getTracks())e.stop();C.value="开始",c.value.srcObject=null}else O(),C.value="暂停"};return W(()=>{l&&l.disconnect(),c.value.srcObject&&V(),$()}),(s,e)=>{const o=P,g=re,u=ie,A=le,G=ae,J=Y;return N(),U(L,null,[t(o,{justify:"center"},{default:n(()=>[f("video",{class:"remoteVideo",ref_key:"remoteVideo",ref:i},null,512)]),_:1}),t(o,{justify:"center",gutter:"50"},{default:n(()=>[t(g,null,{default:n(()=>[f("video",{class:"localVideo",ref_key:"localVideo",ref:c},null,512)]),_:1}),t(g,null,{default:n(()=>[S(t(u,{loading:m.value,class:"link-btn title",onClick:z},{default:n(()=>e[3]||(e[3]=[D("等待专家连线")])),_:1},8,["loading"]),[[j,!r.value]]),S(t(u,{class:"link-btn title",onClick:O},{default:n(()=>e[4]||(e[4]=[D("已匹配，开始面试")])),_:1},512),[[j,r.value&&!v.value]]),S(t(u,{class:"stop-btn title",onClick:V},{default:n(()=>[D(R(C.value),1)]),_:1},512),[[j,v.value]])]),_:1})]),_:1}),t(J,{onClickOverlay:B,show:b.value,"onUpdate:show":e[2]||(e[2]=y=>b.value=y),round:""},{default:n(()=>[f("div",ce,[t(o,{justify:"center"},{default:n(()=>e[5]||(e[5]=[f("h1",{class:"total title"},"面试评价",-1)])),_:1}),t(o,null,{default:n(()=>e[6]||(e[6]=[f("h1",{class:"main title"},"评分:",-1)])),_:1}),t(o,{justify:"center"},{default:n(()=>[t(A,{readonly:"",color:"#ffd21e",modelValue:h(_).score,"onUpdate:modelValue":e[0]||(e[0]=y=>h(_).score=y),"allow-half":""},null,8,["modelValue"])]),_:1}),t(o,{justify:"center"},{default:n(()=>[t(G,{readonly:"",class:"comment title",modelValue:h(_).comment,"onUpdate:modelValue":e[1]||(e[1]=y=>h(_).comment=y),label:"评语:",placeholder:"对这次面试的评语","label-align":"top"},null,8,["modelValue"])]),_:1}),t(o,{justify:"center"},{default:n(()=>[t(u,{class:"comfirm-btn title",onClick:B},{default:n(()=>e[7]||(e[7]=[D("结束这次面试")])),_:1})]),_:1})])]),_:1},8,["show"])],64)}}}),de=x(fe,[["__scopeId","data-v-4b928ab2"]]),me={class:"overview"},pe={class:"main title"},ve={class:"dsp title"},_e={class:"container"},ge=F({__name:"StudentInterview",props:{setID:String},setup(p){const w=d("题目"),c=d("概述");return te(async()=>{try{if(p.setID){const{title:i,description:r}=await se(p.setID);w.value=i,c.value=r}else T("无套题ID")}catch(i){console.error(i),T("请求出错")}}),(i,r)=>{const m=oe,v=ne,k=P;return N(),U(L,null,[t(v,{onClickLeft:r[0]||(r[0]=l=>i.$router.go(-1)),onClickRight:r[1]||(r[1]=l=>i.$router.push("/studentHome"))},{left:n(()=>[t(m,{name:"arrow-left",color:"#323233"})]),title:n(()=>r[2]||(r[2]=[f("h1",{class:"top title"},"专家面试",-1)])),right:n(()=>[t(m,{name:"wap-home-o",color:"black"})]),_:1}),t(k,{justify:"center"},{default:n(()=>[f("div",me,[f("h1",pe,R(w.value),1),f("h2",ve,R(c.value),1)])]),_:1}),f("div",_e,[t(de,{setID:i.$route.query.setID},null,8,["setID"])])],64)}}}),Te=x(ge,[["__scopeId","data-v-dbb2f351"]]);export{Te as default};
