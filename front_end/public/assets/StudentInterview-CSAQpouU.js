import{f as L,O as J,r as d,ar as W,aA as $,o as N,c as U,a as t,w as s,b as f,al as S,am as j,d as h,ay as R,ae as D,K as F,L as X,P as Y,R as O,aB as Z,aC as ee,_ as x,ac as te,ab as oe}from"./index-CpaKEeMo.js";import{R as P}from"./index-CoDWtlbs.js";import{N as se}from"./index-OqzX4nly.js";import{a as ne}from"./index-CJfc-XpA.js";import"./index-xvabcI5u.js";import{F as ae}from"./index-CU7bnnqT.js";import{R as le}from"./index-RDla0aKa.js";import{C as re}from"./index-BgladKTd.js";import{B as ie}from"./index-DhOvqBWh.js";import"./use-placeholder-BvAxgC0s.js";import"./request-M96MMQ4W.js";import"./use-route-Cm_xussw.js";const ce={class:"rate"},ue=!1,fe=L({__name:"StudentVideoChat",props:["setID"],setup(p){const w=J(),c=d(),i=d(),r=d(!1),m=d(!1),v=d(!1);let k=!0,l;const q={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun.l.google.com","stun:stun1.l.google.com"]}]},a=new RTCPeerConnection(q),E={audio:!0,video:!0};let I=!1,_;const b=d(!1),H=X(),T=function(){b.value=!1,c.value.srcObject&&V(),H.push("/studentHome")},M=function(){if(k||l.disconnect(),!p.setID){O("setID出错了，请重新点击");return}l=Z("https://localhost:3000",{query:{username:w.data.username,role:"student",setID:p.setID}}),l.on("isEnd",()=>{ee({duration:0,forbidClick:!0,message:"等待评价中"})}),l.on("theRate",n=>{$(),_=n,b.value=!0}),l.on("ready",()=>{r.value=!0,m.value=!1}),k=!1},A=function(){a.ontrack=({streams:o})=>{i.value.srcObject=o[0],i.value.play()},a.onnegotiationneeded=async()=>{try{I=!0,await a.setLocalDescription(),l.emit("message",{description:a.localDescription})}catch(o){console.error(o)}finally{I=!1}},a.onicecandidate=({candidate:o})=>l.emit("message",{candidate:o}),a.oniceconnectionstatechange=()=>{a.iceConnectionState==="failed"&&a.restartIce()};let n=!1;const e=async({description:o,candidate:g})=>{try{if(o){const u=o.type==="offer"&&(I||a.signalingState!=="stable");if(n=!ue&&u,n)return;await a.setRemoteDescription(o),o.type==="offer"&&(await a.setLocalDescription(),l.emit("message",{description:a.localDescription}))}else if(g)try{await a.addIceCandidate(g)}catch(u){if(!n)throw u}}catch(u){console.error(u)}};l.on("message",e)},K=function(){m.value=!0,M(),A()};async function B(){try{const n=await navigator.mediaDevices.getUserMedia(E);for(const e of n.getTracks())a.addTrack(e,n);c.value.srcObject=n,c.value.play(),v.value=!0}catch(n){console.error(n)}}const C=d("暂停"),V=function(){if(C.value=="暂停"){const n=c.value.srcObject;if(n)for(const e of n.getTracks())e.stop();C.value="开始",c.value.srcObject=null}else B(),C.value="暂停"};return W(()=>{l&&l.disconnect(),c.value.srcObject&&V(),$()}),(n,e)=>{const o=P,g=re,u=ie,Q=le,z=ae,G=Y;return N(),U(F,null,[t(o,{justify:"center"},{default:s(()=>[f("video",{class:"remoteVideo",ref_key:"remoteVideo",ref:i},null,512)]),_:1}),t(o,{justify:"center",gutter:"50"},{default:s(()=>[t(g,null,{default:s(()=>[f("video",{class:"localVideo",ref_key:"localVideo",ref:c},null,512)]),_:1}),t(g,null,{default:s(()=>[S(t(u,{loading:m.value,class:"link-btn title",onClick:K},{default:s(()=>e[3]||(e[3]=[h("等待专家连线")])),_:1},8,["loading"]),[[j,!r.value]]),S(t(u,{class:"link-btn title",onClick:B},{default:s(()=>e[4]||(e[4]=[h("已匹配，开始面试")])),_:1},512),[[j,r.value&&!v.value]]),S(t(u,{class:"stop-btn title",onClick:V},{default:s(()=>[h(R(C.value),1)]),_:1},512),[[j,v.value]])]),_:1})]),_:1}),t(G,{onClickOverlay:T,show:b.value,"onUpdate:show":e[2]||(e[2]=y=>b.value=y),round:""},{default:s(()=>[f("div",ce,[t(o,{justify:"center"},{default:s(()=>e[5]||(e[5]=[f("h1",{class:"total title"},"面试评价",-1)])),_:1}),t(o,null,{default:s(()=>e[6]||(e[6]=[f("h1",{class:"main title"},"评分:",-1)])),_:1}),t(o,{justify:"center"},{default:s(()=>[t(Q,{readonly:"",color:"#ffd21e",modelValue:D(_).score,"onUpdate:modelValue":e[0]||(e[0]=y=>D(_).score=y),"allow-half":""},null,8,["modelValue"])]),_:1}),t(o,{justify:"center"},{default:s(()=>[t(z,{readonly:"",class:"comment title",modelValue:D(_).comment,"onUpdate:modelValue":e[1]||(e[1]=y=>D(_).comment=y),label:"评语:",placeholder:"对这次面试的评语","label-align":"top"},null,8,["modelValue"])]),_:1}),t(o,{justify:"center"},{default:s(()=>[t(u,{class:"comfirm-btn title",onClick:T},{default:s(()=>e[7]||(e[7]=[h("结束这次面试")])),_:1})]),_:1})])]),_:1},8,["show"])],64)}}}),de=x(fe,[["__scopeId","data-v-4b928ab2"]]),me={class:"overview"},pe={class:"main title"},ve={class:"dsp title"},_e={class:"container"},ge=L({__name:"StudentInterview",props:{setID:String},setup(p){const w=d("题目"),c=d("概述");return te(async()=>{try{if(p.setID){const{title:i,description:r}=await ne(p.setID);w.value=i,c.value=r}else O("无套题ID")}catch(i){console.error(i),O("请求出错")}}),(i,r)=>{const m=oe,v=se,k=P;return N(),U(F,null,[t(v,{onClickLeft:r[0]||(r[0]=l=>i.$router.go(-1)),onClickRight:r[1]||(r[1]=l=>i.$router.push("/studentHome"))},{left:s(()=>[t(m,{name:"arrow-left",color:"#323233"})]),title:s(()=>r[2]||(r[2]=[f("h1",{class:"top title"},"专家面试",-1)])),right:s(()=>[t(m,{name:"wap-home-o",color:"black"})]),_:1}),t(k,{justify:"center"},{default:s(()=>[f("div",me,[f("h1",pe,R(w.value),1),f("h2",ve,R(c.value),1)])]),_:1}),f("div",_e,[t(de,{setID:i.$route.query.setID},null,8,["setID"])])],64)}}}),Oe=x(ge,[["__scopeId","data-v-dbb2f351"]]);export{Oe as default};
