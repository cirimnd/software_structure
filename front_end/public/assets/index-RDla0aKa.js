import{r as Y,aF as J,e as K,f as O,X as Q,j as S,aG as W,Z as x,a as h,n as F,m as X,a1 as ee,t as ae,aH as te,ab as G,aI as U,$ as oe,A as le,g as se}from"./index-CpaKEeMo.js";function ne(){const e=Y([]),s=[];return J(()=>{e.value=[]}),[e,i=>(s[i]||(s[i]=u=>{e.value[i]=u}),s[i])]}const[ie,m]=K("rate");function re(e,s,n,i){return e>=s?{status:"full",value:1}:e+.5>=s&&n&&!i?{status:"half",value:.5}:e+1>=s&&n&&i?{status:"half",value:Math.round((e-s+1)*1e10)/1e10}:{status:"void",value:0}}const ue={size:F,icon:X("star"),color:String,count:ee(5),gutter:F,clearable:Boolean,readonly:Boolean,disabled:Boolean,voidIcon:X("star-o"),allowHalf:Boolean,voidColor:String,touchable:ae,iconPrefix:String,modelValue:te(0),disabledColor:String};var ce=O({name:ie,props:ue,emits:["change","update:modelValue"],setup(e,{emit:s}){const n=Q(),[i,u]=ne(),g=Y(),T=S(()=>e.readonly||e.disabled),I=S(()=>T.value||!e.touchable),j=S(()=>Array(+e.count).fill("").map((t,a)=>re(e.modelValue,a+1,e.allowHalf,e.readonly)));let l,c,v=Number.MAX_SAFE_INTEGER,b=Number.MIN_SAFE_INTEGER;const V=()=>{c=U(g);const t=i.value.map(U);l=[],t.forEach((a,o)=>{v=Math.min(a.top,v),b=Math.max(a.top,b),e.allowHalf?l.push({score:o+.5,left:a.left,top:a.top,height:a.height},{score:o+1,left:a.left+a.width/2,top:a.top,height:a.height}):l.push({score:o+1,left:a.left,top:a.top,height:a.height})})},N=(t,a)=>{for(let o=l.length-1;o>0;o--)if(a>=c.top&&a<=c.bottom){if(t>l[o].left&&a>=l[o].top&&a<=l[o].top+l[o].height)return l[o].score}else{const d=a<c.top?v:b;if(t>l[o].left&&l[o].top===d)return l[o].score}return e.allowHalf?.5:1},y=t=>{T.value||t===e.modelValue||(s("update:modelValue",t),s("change",t))},D=t=>{I.value||(n.start(t),V())},L=t=>{if(!I.value&&(n.move(t),n.isHorizontal()&&!n.isTap.value)){const{clientX:a,clientY:o}=t.touches[0];oe(t),y(N(a,o))}},Z=(t,a)=>{const{icon:o,size:d,color:C,count:E,gutter:k,voidIcon:w,disabled:r,voidColor:H,allowHalf:z,iconPrefix:B,disabledColor:M}=e,R=a+1,P=t.status==="full",f=t.status==="void",$=z&&t.value>0&&t.value<1;let _;k&&R!==+E&&(_={paddingRight:le(k)});const q=A=>{V();let p=z?N(A.clientX,A.clientY):R;e.clearable&&n.isTap.value&&p===e.modelValue&&(p=0),y(p)};return h("div",{key:a,ref:u(a),role:"radio",style:_,class:m("item"),tabindex:r?void 0:0,"aria-setsize":E,"aria-posinset":R,"aria-checked":!f,onClick:q},[h(G,{size:d,name:P?o:w,class:m("icon",{disabled:r,full:P}),color:r?M:P?C:H,classPrefix:B},null),$&&h(G,{size:d,style:{width:t.value+"em"},name:f?w:o,class:m("icon",["half",{disabled:r,full:!f}]),color:r?M:f?H:C,classPrefix:B},null)])};return W(()=>e.modelValue),x("touchmove",L,{target:g}),()=>h("div",{ref:g,role:"radiogroup",class:m({readonly:e.readonly,disabled:e.disabled}),tabindex:e.disabled?void 0:0,"aria-disabled":e.disabled,"aria-readonly":e.readonly,onTouchstartPassive:D},[j.value.map(Z)])}});const fe=se(ce);export{fe as R};
