import{f as E,r as u,Q as N,j as A,ac as $,s as F,ar as H,o as D,c as B,a as e,w as t,b as f,al as U,am as O,d as S,ay as T,K as L,L as K,P as G,_ as P,ad as J,ae as W,R as X,ab as Y,a8 as Z,az as ee}from"./index-CpaKEeMo.js";import{R as Q}from"./index-CoDWtlbs.js";import{L as te}from"./index-FFRmgr_N.js";import"./index-xvabcI5u.js";import{a as oe,C as ae}from"./index-Ba4kjeJb.js";import{N as ne}from"./index-OqzX4nly.js";import{F as se}from"./index-CU7bnnqT.js";import{R as le}from"./index-RDla0aKa.js";import{C as re}from"./index-BgladKTd.js";import{B as ie}from"./index-DhOvqBWh.js";import{a as ce}from"./index-CJfc-XpA.js";import"./use-route-Cm_xussw.js";import"./use-placeholder-BvAxgC0s.js";import"./request-M96MMQ4W.js";const ue={class:"rate"},fe=!0,de=E({__name:"ExpertVideoChat",setup(w){const i=u(),v=u(),k=N(),d=A(()=>k.socket),_={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun.l.google.com","stun:stun1.l.google.com"]}]},n=new RTCPeerConnection(_),h={audio:!0,video:!0};let C=!1;const m=function(){n.ontrack=({streams:a})=>{v.value.srcObject=a[0],v.value.play()},n.onnegotiationneeded=async()=>{try{C=!0,await n.setLocalDescription(),d.value.emit("message",{description:n.localDescription})}catch(a){console.error(a)}finally{C=!1}},n.onicecandidate=({candidate:a})=>d.value.emit("message",{candidate:a}),n.oniceconnectionstatechange=()=>{n.iceConnectionState==="failed"&&n.restartIce()};let r=!1;const o=async({description:a,candidate:b})=>{try{if(a){const c=a.type==="offer"&&(C||n.signalingState!=="stable");if(r=!fe&&c,r)return;await n.setRemoteDescription(a),a.type==="offer"&&(await n.setLocalDescription(),d.value.emit("message",{description:n.localDescription}))}else if(b)try{await n.addIceCandidate(b)}catch(c){if(!r)throw c}}catch(c){console.error(c)}};d.value.on("message",o)},s=u(!1);async function x(){try{const r=await navigator.mediaDevices.getUserMedia(h);for(const o of r.getTracks())n.addTrack(o,r);i.value.srcObject=r,i.value.play(),s.value=!0}catch(r){console.error(r)}}$(()=>{m()});const g=u("暂停"),V=function(){if(g.value=="暂停"){const r=i.value.srcObject;if(r)for(const o of r.getTracks())o.stop();g.value="开始",i.value.srcObject=null}else x(),g.value="暂停"},y=u(!1),R=function(){console.log("结束面试"),d.value.emit("end"),y.value=!0},p=F({score:2.5,comment:"好"}),I=K(),l=function(){d.value.emit("rate",p),y.value=!1,V(),I.push("/expertHome")};return H(()=>{i.value.srcObject&&V()}),(r,o)=>{const a=Q,b=re,c=ie,q=le,M=se,z=G;return D(),B(L,null,[e(a,{justify:"center"},{default:t(()=>[f("video",{class:"remoteVideo",ref_key:"remoteVideo",ref:v},null,512)]),_:1}),e(a,{justify:"center",gutter:"50"},{default:t(()=>[e(b,null,{default:t(()=>[f("video",{class:"localVideo",ref_key:"localVideo",ref:i},null,512)]),_:1}),e(b,null,{default:t(()=>[e(a,{justify:"center"},{default:t(()=>[U(e(c,{class:"link-btn title",onClick:x},{default:t(()=>o[3]||(o[3]=[S("开始连线")])),_:1},512),[[O,!s.value]])]),_:1}),e(a,{justify:"center"},{default:t(()=>[U(e(c,{class:"stop-btn title",onClick:V},{default:t(()=>[S(T(g.value),1)]),_:1},512),[[O,s.value]])]),_:1}),e(a,{justify:"center"},{default:t(()=>[e(c,{class:"end-btn title",onClick:R},{default:t(()=>o[4]||(o[4]=[S("结束面试")])),_:1})]),_:1})]),_:1})]),_:1}),e(z,{show:y.value,"onUpdate:show":o[2]||(o[2]=j=>y.value=j),round:""},{default:t(()=>[f("div",ue,[e(a,{justify:"center"},{default:t(()=>o[5]||(o[5]=[f("h1",{class:"total title"},"面试评价",-1)])),_:1}),e(a,null,{default:t(()=>o[6]||(o[6]=[f("h1",{class:"main title"},"评分:",-1)])),_:1}),e(a,{justify:"center"},{default:t(()=>[e(q,{color:"#ffd21e",modelValue:p.score,"onUpdate:modelValue":o[0]||(o[0]=j=>p.score=j),"allow-half":""},null,8,["modelValue"])]),_:1}),e(a,{justify:"center"},{default:t(()=>[e(M,{class:"comment title",modelValue:p.comment,"onUpdate:modelValue":o[1]||(o[1]=j=>p.comment=j),label:"评语:",placeholder:"对这次面试的评语","label-align":"top"},null,8,["modelValue"])]),_:1}),e(a,{justify:"center"},{default:t(()=>[e(c,{class:"comfirm-btn title",onClick:l},{default:t(()=>o[7]||(o[7]=[S("确认评价")])),_:1})]),_:1})])]),_:1},8,["show"])],64)}}}),me=P(de,[["__scopeId","data-v-bb87edb6"]]),pe={class:"overview"},ve={class:"question-title title"},_e={class:"answer"},ge={class:"container"},ye=E({__name:"ExpertInterview",props:{room:String,setID:String},setup(w){const i=N(),v=u([]);$(()=>{i.first&&i.initSocket(),w.room&&i.linkStudent(w.room)});const k=u(!1),d=u(!1),_=u(!1);let n=F([]);const h=u(""),C=async()=>{try{if(w.setID){const{questions:m,title:s}=await ce(w.setID);n=m,h.value=s,_.value=!1,d.value=!0}else{X("无题库ID");return}}catch(m){console.error(m),k.value=!1,_.value=!0}};return(m,s)=>{const x=Y,g=ne,V=ee,y=ae,R=oe,p=te,I=Q;return D(),B(L,null,[e(g,{onClickLeft:s[0]||(s[0]=l=>m.$router.go(-1))},{left:t(()=>[e(x,{name:"arrow-left",color:"#323233"})]),title:t(()=>s[4]||(s[4]=[f("h1",{class:"top title"},"面试学生",-1)])),_:1}),e(I,{justify:"center"},{default:t(()=>[f("div",pe,[f("h1",ve,T(h.value),1),e(I,{justify:"center"},{default:t(()=>[e(p,{loading:k.value,"onUpdate:loading":s[2]||(s[2]=l=>k.value=l),finished:d.value,error:_.value,"onUpdate:error":s[3]||(s[3]=l=>_.value=l),"error-text":"请求失败，点击重新加载",onLoad:C,class:"question"},{default:t(()=>[e(R,{modelValue:v.value,"onUpdate:modelValue":s[1]||(s[1]=l=>v.value=l)},{default:t(()=>[(D(!0),B(L,null,J(W(n),l=>(D(),Z(y,{key:l.id,class:"title",title:l.questionText,name:l.id},{default:t(()=>[e(V,{name:"answer",width:"0.9rem",height:"0.9rem"}),f("span",_e,T(l.correctAnswer),1)]),_:2},1032,["title","name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["loading","finished","error"])]),_:1})])]),_:1}),f("div",ge,[e(me)])],64)}}}),Le=P(ye,[["__scopeId","data-v-1a12d46d"]]);export{Le as default};
