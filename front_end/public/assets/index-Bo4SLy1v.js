import{r as U,aG as j,q as O,f as Q,B as W,C as I,aH as Z,H as x,a as h,y as F,M as G,K as ee,L as ae,aI as te,$ as X,aJ as L,I as oe,a9 as le,e as se}from"./index-WXGUVd8R.js";function ne(){const e=U([]),s=[];return j(()=>{e.value=[]}),[e,i=>(s[i]||(s[i]=u=>{e.value[i]=u}),s[i])]}const[ie,m]=O("rate");function re(e,s,n,i){return e>=s?{status:"full",value:1}:e+.5>=s&&n&&!i?{status:"half",value:.5}:e+1>=s&&n&&i?{status:"half",value:Math.round((e-s+1)*1e10)/1e10}:{status:"void",value:0}}const ue={size:F,icon:G("star"),color:String,count:ee(5),gutter:F,clearable:Boolean,readonly:Boolean,disabled:Boolean,voidIcon:G("star-o"),allowHalf:Boolean,voidColor:String,touchable:ae,iconPrefix:String,modelValue:te(0),disabledColor:String};var ce=Q({name:ie,props:ue,emits:["change","update:modelValue"],setup(e,{emit:s}){const n=W(),[i,u]=ne(),g=U(),S=I(()=>e.readonly||e.disabled),T=I(()=>S.value||!e.touchable),Y=I(()=>Array(+e.count).fill("").map((t,a)=>re(e.modelValue,a+1,e.allowHalf,e.readonly)));let l,c,v=Number.MAX_SAFE_INTEGER,b=Number.MIN_SAFE_INTEGER;const V=()=>{c=L(g);const t=i.value.map(L);l=[],t.forEach((a,o)=>{v=Math.min(a.top,v),b=Math.max(a.top,b),e.allowHalf?l.push({score:o+.5,left:a.left,top:a.top,height:a.height},{score:o+1,left:a.left+a.width/2,top:a.top,height:a.height}):l.push({score:o+1,left:a.left,top:a.top,height:a.height})})},y=(t,a)=>{for(let o=l.length-1;o>0;o--)if(a>=c.top&&a<=c.bottom){if(t>l[o].left&&a>=l[o].top&&a<=l[o].top+l[o].height)return l[o].score}else{const d=a<c.top?v:b;if(t>l[o].left&&l[o].top===d)return l[o].score}return e.allowHalf?.5:1},C=t=>{S.value||t===e.modelValue||(s("update:modelValue",t),s("change",t))},q=t=>{T.value||(n.start(t),V())},D=t=>{if(!T.value&&(n.move(t),n.isHorizontal()&&!n.isTap.value)){const{clientX:a,clientY:o}=t.touches[0];oe(t),C(y(a,o))}},J=(t,a)=>{const{icon:o,size:d,color:N,count:E,gutter:H,voidIcon:k,disabled:r,voidColor:w,allowHalf:B,iconPrefix:M,disabledColor:z}=e,R=a+1,P=t.status==="full",f=t.status==="void",K=B&&t.value>0&&t.value<1;let _;H&&R!==+E&&(_={paddingRight:le(H)});const $=A=>{V();let p=B?y(A.clientX,A.clientY):R;e.clearable&&n.isTap.value&&p===e.modelValue&&(p=0),C(p)};return h("div",{key:a,ref:u(a),role:"radio",style:_,class:m("item"),tabindex:r?void 0:0,"aria-setsize":E,"aria-posinset":R,"aria-checked":!f,onClick:$},[h(X,{size:d,name:P?o:k,class:m("icon",{disabled:r,full:P}),color:r?z:P?N:w,classPrefix:M},null),K&&h(X,{size:d,style:{width:t.value+"em"},name:f?k:o,class:m("icon",["half",{disabled:r,full:!f}]),color:r?z:f?w:N,classPrefix:M},null)])};return Z(()=>e.modelValue),x("touchmove",D,{target:g}),()=>h("div",{ref:g,role:"radiogroup",class:m({readonly:e.readonly,disabled:e.disabled}),tabindex:e.disabled?void 0:0,"aria-disabled":e.disabled,"aria-readonly":e.readonly,onTouchstartPassive:q},[Y.value.map(J)])}});const fe=se(ce);export{fe as R};
