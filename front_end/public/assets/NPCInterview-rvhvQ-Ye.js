import{n as U,f as $,r as _,aq as H,ai as Q,o as P,c as B,a as c,w as f,b as V,ac as C,ad as j,d as x,F as E,$ as q,_ as I,ar as T,a1 as G,X,as as Y}from"./index-WXGUVd8R.js";import{R as D}from"./index-lwTdiljL.js";import{L as J}from"./index-CnlKp80F.js";import"./index-CMBfAjpb.js";import{a as K,C as W}from"./index-6YlC_pxU.js";import{N as Z}from"./index-CahTtWIC.js";import{a as ee}from"./index-DAOWbYVA.js";import{C as te}from"./index-BV5GXoeu.js";import{a as ne}from"./function-call-2XNXHHU2.js";import{B as se}from"./index-DLf2m0OP.js";import"./use-route-BdHUjtqw.js";import"./use-placeholder-ClGZrsmh.js";import"./request-BsTyHzWx.js";var O={},v={};Object.defineProperty(v,"__esModule",{value:!0});v.trim=v.isObject=v.isNil=v.isNan=v.size=v.isString=v.validateLocale=v.splitSentences=void 0;var ie=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return n.replace(/\.+/g,".|").replace(/\?/g,"?|").replace(/\!/g,"!|").split("|").map(function(e){return A(e)}).filter(Boolean)};v.splitSentences=ie;var ae=/^(?:(en-GB-oed|i-ami|i-bnn|i-default|i-enochian|i-hak|i-klingon|i-lux|i-mingo|i-navajo|i-pwn|i-tao|i-tay|i-tsu|sgn-BE-FR|sgn-BE-NL|sgn-CH-DE)|(art-lojban|cel-gaulish|no-bok|no-nyn|zh-guoyu|zh-hakka|zh-min|zh-min-nan|zh-xiang))$|^((?:[a-z]{2,3}(?:(?:-[a-z]{3}){1,3})?)|[a-z]{4}|[a-z]{5,8})(?:-([a-z]{4}))?(?:-([a-z]{2}|\d{3}))?((?:-(?:[\da-z]{5,8}|\d[\da-z]{3}))*)?((?:-[\da-wy-z](?:-[\da-z]{2,8})+)*)?(-x(?:-[\da-z]{1,8})+)?$|^(x(?:-[\da-z]{1,8})+)$/i,oe=function(n){return typeof n!="string"?!1:ae.test(n)};v.validateLocale=oe;var F=function(n){return typeof n=="string"||n instanceof String};v.isString=F;var re=function(n){return n&&Array.isArray(n)&&n.length?n.length:0};v.size=re;var le=function(n){return typeof n=="number"&&isNaN(n)};v.isNan=le;var ce=function(n){return n==null};v.isNil=ce;var ue=function(n){return Object.prototype.toString.call(n)==="[object Object]"};v.isObject=ue;var A=function(n){return F(n)?n.trim():""};v.trim=A;Object.defineProperty(O,"__esModule",{value:!0});var M=O.default=void 0,a=v;function fe(s,n){if(!(s instanceof n))throw new TypeError("Cannot call a class as a function")}function ve(s,n){for(var e=0;e<n.length;e++){var t=n[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(s,t.key,t)}}function pe(s,n,e){return n&&ve(s.prototype,n),s}var de=function(){function s(){fe(this,s),this.browserSupport="speechSynthesis"in window&&"SpeechSynthesisUtterance"in window,this.synthesisVoice=null}return pe(s,[{key:"init",value:function(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new Promise(function(r,h){e.browserSupport||h("Your browser does not support Speech Synthesis");var g=(0,a.isNil)(t.listeners)?{}:t.listeners,y=(0,a.isNil)(t.splitSentences)?!0:t.splitSentences,S=(0,a.isNil)(t.lang)?void 0:t.lang,w=(0,a.isNil)(t.volume)?1:t.volume,u=(0,a.isNil)(t.rate)?1:t.rate,o=(0,a.isNil)(t.pitch)?1:t.pitch,m=(0,a.isNil)(t.voice)?void 0:t.voice;Object.keys(g).forEach(function(p){var b=g[p],N=function(i){b&&b(i)};p!=="onvoiceschanged"&&(speechSynthesis[p]=N)}),e._loadVoices().then(function(p){g.onvoiceschanged&&g.onvoiceschanged(p),!(0,a.isNil)(S)&&e.setLanguage(S),!(0,a.isNil)(m)&&e.setVoice(m),!(0,a.isNil)(w)&&e.setVolume(w),!(0,a.isNil)(u)&&e.setRate(u),!(0,a.isNil)(o)&&e.setPitch(o),!(0,a.isNil)(y)&&e.setSplitSentences(y),r({voices:p,lang:e.lang,voice:e.voice,volume:e.volume,rate:e.rate,pitch:e.pitch,splitSentences:e.splitSentences,browserSupport:e.browserSupport})}).catch(function(p){h(p)})})}},{key:"_fetchVoices",value:function(){return new Promise(function(e,t){setTimeout(function(){var r=speechSynthesis.getVoices();return(0,a.size)(r)>0?e(r):t("Could not fetch voices")},100)})}},{key:"_loadVoices",value:function(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._fetchVoices().catch(function(r){if(t===0)throw r;return e._loadVoices(t-1)})}},{key:"hasBrowserSupport",value:function(){return this.browserSupport}},{key:"setVoice",value:function(e){var t,r=speechSynthesis.getVoices();if((0,a.isString)(e)&&(t=r.find(function(h){return h.name===e})),(0,a.isObject)(e)&&(t=e),t)this.synthesisVoice=t;else throw"Error setting voice. The voice you passed is not valid or the voices have not been loaded yet."}},{key:"setLanguage",value:function(e){if(e=e.replace("_","-"),(0,a.validateLocale)(e))this.lang=e;else throw"Error setting language. Please verify your locale is BCP47 format (http://schneegans.de/lv/?tags=es-FR&format=text)"}},{key:"setVolume",value:function(e){if(e=parseFloat(e),!(0,a.isNan)(e)&&e>=0&&e<=1)this.volume=e;else throw"Error setting volume. Please verify your volume value is a number between 0 and 1."}},{key:"setRate",value:function(e){if(e=parseFloat(e),!(0,a.isNan)(e)&&e>=0&&e<=10)this.rate=e;else throw"Error setting rate. Please verify your volume value is a number between 0 and 10."}},{key:"setPitch",value:function(e){if(e=parseFloat(e),!(0,a.isNan)(e)&&e>=0&&e<=2)this.pitch=e;else throw"Error setting pitch. Please verify your pitch value is a number between 0 and 2."}},{key:"setSplitSentences",value:function(e){this.splitSentences=e}},{key:"speak",value:function(e){var t=this;return new Promise(function(r,h){var g=e.text,y=e.listeners,S=y===void 0?{}:y,w=e.queue,u=w===void 0?!0:w,o=(0,a.trim)(g);(0,a.isNil)(o)&&r(),!u&&t.cancel();var m=[],p=t.splitSentences?(0,a.splitSentences)(o):[o];p.forEach(function(b,N){var d=N===(0,a.size)(p)-1,i=new SpeechSynthesisUtterance;t.synthesisVoice&&(i.voice=t.synthesisVoice),t.lang&&(i.lang=t.lang),t.volume&&(i.volume=t.volume),t.rate&&(i.rate=t.rate),t.pitch&&(i.pitch=t.pitch),i.text=b,Object.keys(S).forEach(function(k){var l=S[k],z=function(R){l&&l(R),k==="onerror"&&h({utterances:m,lastUtterance:i,error:R}),k==="onend"&&d&&r({utterances:m,lastUtterance:i})};i[k]=z}),m.push(i),speechSynthesis.speak(i)})})}},{key:"pending",value:function(){return speechSynthesis.pending}},{key:"paused",value:function(){return speechSynthesis.paused}},{key:"speaking",value:function(){return speechSynthesis.speaking}},{key:"pause",value:function(){speechSynthesis.pause()}},{key:"resume",value:function(){speechSynthesis.resume()}},{key:"cancel",value:function(){speechSynthesis.cancel()}}]),s}(),he=de;M=O.default=he;function me(){const s=new M;s.hasBrowserSupport()||U("浏览器不支持文字转音频"),s.init({volume:.6,lang:"zh-CN",rate:1,pitch:1,voice:"Microsoft Huihui - Chinese (Simplified, PRC)",listeners:{}}).then(()=>{}).catch(t=>{console.error("初始化时发生错误 : ",t)});function n(t){s.speak({text:t}).then(()=>{console.log("Success !")}).catch(r=>{console.error("An error occurred :",r)})}function e(){s.cancel()}return{speak:n,speechStop:e}}const ge="video/webm; codecs=vp9,opus",ye=$({__name:"NPCVideoChat",props:{questions:{},isEnd:{type:Function}},setup(s){const{speak:n,speechStop:e}=me(),t=_(),r=H("a");let h;const g=[];function y(d){d.data.size>0?g.push(d.data):console.log("无数据")}const S=function(){const d=new Blob(g,{type:"video/mp4"}),i=URL.createObjectURL(d);r.value?(r.value.href=i,r.value.download="面试视频",r.value.click(),URL.revokeObjectURL(i)):console.error("a元素初始化失败")},w={audio:!0,video:!0},u=_(!0);async function o(){try{const d=await navigator.mediaDevices.getUserMedia(w);t.value.srcObject=d,h=new MediaRecorder(d,{audioBitsPerSecond:128e3,videoBitsPerSecond:25e5,mimeType:ge}),h.ondataavailable=y,t.value.play(),m=0,u.value=!1,p.value=!1,s.isEnd(!1),h.start(),n("人机面试开始，在听完并回答完问题后，即可点击下一题继续面试"),b()}catch(d){console.error(d)}}let m=0;const p=_(!1),b=function(){m<s.questions.length?n(`问题${m+1}:`+s.questions[m++].questionText):(n("面试结束，请自行查看答案"),h.stop(),ne({title:"保存面试录屏",message:"是否需要保存面试录屏"}).then(()=>{S()}).catch(()=>{}),p.value=!0,s.isEnd(!0))},N=function(){const d=t.value.srcObject;for(const i of d.getTracks())i.stop();t.value.srcObject=null,u.value=!0,e()};return Q(()=>{t.value.srcObject&&N()}),(d,i)=>{const k=q,l=D,z=te,L=se;return P(),B(E,null,[c(l,{justify:"center"},{default:f(()=>[c(k,{name:"volume-o",class:"npc",size:"4rem"})]),_:1}),c(l,{justify:"center",gutter:"50"},{default:f(()=>[c(z,null,{default:f(()=>[V("video",{class:"localVideo",ref_key:"localVideo",ref:t},null,512)]),_:1}),c(z,null,{default:f(()=>[c(l,{justify:"center"},{default:f(()=>[C(c(L,{class:"start-btn title",onClick:o},{default:f(()=>i[0]||(i[0]=[x("开始面试")])),_:1},512),[[j,u.value]])]),_:1}),c(l,{justify:"center"},{default:f(()=>[C(c(L,{class:"next-btn title",onClick:b},{default:f(()=>i[1]||(i[1]=[x("下一题")])),_:1},512),[[j,!u.value&&!p.value]])]),_:1}),c(l,{justify:"center"},{default:f(()=>[C(c(L,{class:"stop-btn title",onClick:N},{default:f(()=>i[2]||(i[2]=[x("关闭摄像头")])),_:1},512),[[j,!u.value]])]),_:1})]),_:1})]),_:1}),V("a",{ref_key:"a",ref:r,style:{display:"none"}},null,512)],64)}}}),_e=I(ye,[["__scopeId","data-v-8fdc6a03"]]),Se={class:"overview"},we={class:"title"},be={class:"tip title"},ke={class:"answer"},Ne={class:"container"},Ve=$({__name:"NPCInterview",props:{setID:String},setup(s){const n=_(!1),e=_([]),t=_(!1),r=_(!1),h=_(!1),g=_([]),y=_("题目"),S=async()=>{try{if(s.setID){const{questions:u,title:o}=await ee(s.setID);g.value=u,y.value=o,h.value=!1,r.value=!0}else{U("无题库ID");return}}catch(u){console.error(u),t.value=!1,h.value=!0}},w=function(u){n.value=u};return(u,o)=>{const m=q,p=Z,b=Y,N=W,d=K,i=J,k=D;return P(),B(E,null,[c(p,{onClickLeft:o[0]||(o[0]=l=>u.$router.go(-1)),onClickRight:o[1]||(o[1]=l=>u.$router.push("/studentHome"))},{left:f(()=>[c(m,{name:"arrow-left",color:"#323233"})]),title:f(()=>o[5]||(o[5]=[V("h1",{class:"top title"},"人机面试",-1)])),right:f(()=>[c(m,{name:"wap-home-o",color:"black"})]),_:1}),c(k,{justify:"center"},{default:f(()=>[V("div",Se,[V("h1",we,T(y.value),1),c(k,{justify:"center"},{default:f(()=>[c(i,{loading:t.value,"onUpdate:loading":o[3]||(o[3]=l=>t.value=l),finished:r.value,error:h.value,"onUpdate:error":o[4]||(o[4]=l=>h.value=l),"error-text":"请求失败，点击重新加载",onLoad:S,class:"question"},{default:f(()=>[C(V("h1",be,"在面试结束后会在此处展示答案",512),[[j,!n.value]]),C(c(d,{modelValue:e.value,"onUpdate:modelValue":o[2]||(o[2]=l=>e.value=l)},{default:f(()=>[(P(!0),B(E,null,G(g.value,l=>(P(),X(N,{key:l.id,class:"title",title:l.questionText,name:l.id},{default:f(()=>[c(b,{name:"answer",width:"0.9rem",height:"0.9rem"}),V("span",ke,T(l.correctAnswer),1)]),_:2},1032,["title","name"]))),128))]),_:1},8,["modelValue"]),[[j,n.value]])]),_:1},8,["loading","finished","error"])]),_:1})])]),_:1}),V("div",Ne,[c(_e,{questions:g.value,isEnd:w},null,8,["questions"])])],64)}}}),qe=I(Ve,[["__scopeId","data-v-a06bb0f7"]]);export{qe as default};
